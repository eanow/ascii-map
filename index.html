<head>
<script src="jquery-3.6.3.min.js"></script>
</head>

<script type="text/javascript">
let drag="up";
let drag_corner_row=0;
let drag_corner_col=0;
let submap="ground";
function current_marker() {
    let rval="0";
    //base on palette
    switch(submap) {
        case "ground":
            let picked = $('input[name="ground_material"]:checked').val();
            console.log(picked);
            switch(picked) {
                case "ground_dirt":
                    rval='D';
                    break;
                case "ground_grass":
                    rval='G';
                    break;
                case "ground_rock":
                    rval='R';
                    break;
                case "ground_water":
                    rval='W';
                    break;
                case "ground_tile":
                    rval='T';
                    break;
                case "ground_wood":
                    rval='H';
                    break;
            }
            break;
    }
    return rval;
}
function edit_ground() {
    submap="ground";
}
function edit_walls() {
    submap="walls";
}
function edit_characters() {
    submap="characters";
}
function click_rewrite() {
    $(this).text("X")
    let myCol = $(this).attr("id");
    let myRow = $(this).parent().attr("id");
    $("#col_display").text(myCol);
    $("#row_display").text(myRow);
    let paint=current_marker();
    switch(submap) {
        case "ground":
            $(".ground_map").children("#"+myRow).children("#"+myCol).text(paint);
            break;
        case "walls":
            $(".wall_map").children("#"+myRow).children("#"+myCol).text(paint);
            break;
        case "characters":
            $(".character_map").children("#"+myRow).children("#"+myCol).text(paint);
            break;
    }
}
function fresh_map() {
    //get input
    rows=$("#num_rows").val();
    cols=$("#num_cols").val();
    
    //empty the map area
    $(".map_canvas").empty();
    //empty the holders
    $(".ground_map").empty();
    $(".wall_map").empty();
    $(".character_map").empty();
    //fill with rows worth of p elements
    for(ii=0;ii<rows;ii+=1) {
        $( ".map_canvas" ).append("<p class=\"map_pixel\" id=\""+ii+"\"></p>");
        $( ".ground_map" ).append("<p class=\"map_pixel\" id=\""+ii+"\"></p>");
        $( ".wall_map" ).append("<p class=\"map_pixel\" id=\""+ii+"\"></p>");
        $( ".character_map" ).append("<p class=\"map_pixel\" id=\""+ii+"\"></p>");
    }
    //fill each p element with cols span elements
    for (jj=0; jj< cols; jj+=1) {
        $('p.map_pixel').append("<span id=\""+jj+"\">0</span>");
    }
    console.log("Creating Fresh Map");

    $('p.map_pixel span').click(
        click_rewrite
    );

    $('p.map_pixel span').mousedown(
        function() {
            //functionality will alter based on mode
            switch(submap) {
                case "ground":
                    drag_corner_col = $(this).attr("id");
                    drag_corner_row = $(this).parent().attr("id");
                    drag = "down"
                    break;
            }
            $('#state').text("Down");
            draw=1;
        }
    );

    $('p.map_pixel span').mouseup(
        function() {
            //functionality will alter based on mode
            switch(submap) {
                case "ground":
                    myCol = $(this).attr("id");
                    myRow = $(this).parent().attr("id");
                    drag = "up";
                    update_square(drag_corner_col,myCol,drag_corner_row,myRow,"ground");
                    break;
            }
            $('#state').text("Up");
            draw=0;
        }
    );

    /*$('p.map_pixel span').hover(
        function() {
            if (draw === 1) {
                $(this).text("G")
            }
        }
    );*/
}
function update_square(x1, x2, y1, y2, submap) {
    //swap if first is larger
    if (x1>x2) {
        tempX=x1;
        x1=x2;
        x2=tempX;
    }
    if (y1>y2) {
        tempY=y1;
        y1=y2;
        y2=tempY;
    }
    console.log("drawing a square");
    let paint=current_marker();
    for (ii=x1; ii<=x2; ii++) {
        for (jj=y1; jj<=y2; jj++) {
            switch(submap) {
                case "ground":
                    $(".ground_map").children("#"+jj).children("#"+ii).text(paint);
                    break;
            }
        }
    }
}
</script>

<style type='text/css'>
p.map_pixel {
font-family: monospace;
line-height: 0em;
font-size: 30;
-moz-user-select: -moz-none;
-khtml-user-select: none;
-webkit-user-select: none;
-o-user-select: none;
user-select: none;
}
</style>
<p></p>
<div style="width: 100%; display:table;">
    <div style="display: table-row;">
        <div class="map_canvas" style="display: table-cell;">

        </div>
        <div class="drawing_palette" style="display: table-cell;"></div>
            <div style="display: table-row;">
                <div class="palette_select" style="display: table-cell;">
                    <button onclick="edit_ground()">Ground</button><br />
                    <button onclick="edit_walls()">Walls</button><br />
                    <button onclick="edit_characters()">Actors</button><br />
                </div>
            </div>
            <div style="display: table-row;">
                <!-- palette for ground; stuff like dirt, grass, interior tile, etc -->
                <div class="ground_palette" style="display: table-cell;">
                    <input type="radio" name="ground_material" value="ground_dirt" id="ground_dirt" checked>
                    <label for="ground_dirt">Dirt</label>
                    <br />
                    <input type="radio" name="ground_material" value="ground_grass" id="ground_grass">
                    <label for="ground_grass">Grass</label>
                    <br />
                    <input type="radio" name="ground_material" value="ground_rock" id="ground_rock">
                    <label for="ground_rock">Rocky</label>
                    <br />
                    <input type="radio" name="ground_material" value="ground_water" id="ground_water">
                    <label for="ground_water">Water</label>
                    <br />
                    <input type="radio" name="ground_material" value="ground_tile" id="ground_tile">
                    <label for="ground_tile">Tile/Finished Stone</label>
                    <br />
                    <input type="radio" name="ground_material" value="ground_wood" id="ground_wood">
                    <label for="ground_wood">Wooden</label>
                </div>
            </div>
        </div>
    </div>
</div>
<br />
<hr>

<p>11111</p>
<p></p>
<!-- debug -->
State:<span id="state"></span>
X:<span id="col_display"></span>
Y:<span id="row_display"></span>
<br />
<!-- create map -->
<label for="num_rows">Rows:</label>
<input type="number" id="num_rows" name="Rows">
<label for="num_cols">Columns:</label>
<input type="number" id="num_cols" name="Cols">
<button onclick="fresh_map()">Create New Map</button> 
<br />
<!--holder maps-->
<div style="display: table;">
    <div style="display: table-row;"></div>
        <div class="ground_map" style="display: table-cell;"></div>
        <div style="width: 10px; display: table-cell;"></div>
        <div class="wall_map" style="display: table-cell;"></div>
        <div style="width: 10px; display: table-cell;"></div>
        <div class="character_map" style="display: table-cell;"></div>
    </div>
</div>
<!--
/*
<p>Each word will be wrapped in a span.</p>
<p>A second paragraph here.</p>
Word: <span id="word"></span>

<script type="text/javascript">
    $(function() {
        // wrap words in spans
        $('p').each(function() {
            var $this = $(this);
            $this.html($this.text().replace(/\b(\w+)\b/g, "<span>$1</span>"));
        });

        // bind to each span
        $('p span').hover(
            function() { $('#word').text($(this).css('background-color','#ffff66').text()); },
            function() { $('#word').text(''); $(this).css('background-color',''); }
        );
    });
</script>
*/
-->